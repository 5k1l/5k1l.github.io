<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="CVE-2020-0022 复现还差最后的rop部分 本文所用到的文件放在github 准备调试相关测试用的电脑系统是Ubuntu18.04 蓝牙设备 intel 8265 安装完必要的驱动以及工具之后需要修复一个小问题 12345Wel, FWIW, I changed the following two settings in &#x2F;etc&#x2F;default&#x2F;bluetooth :HID2HCI_E">
<meta property="og:type" content="article">
<meta property="og:title" content="cve-2020-0022">
<meta property="og:url" content="http://example.com/2020/12/16/cve-2020-0022/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="CVE-2020-0022 复现还差最后的rop部分 本文所用到的文件放在github 准备调试相关测试用的电脑系统是Ubuntu18.04 蓝牙设备 intel 8265 安装完必要的驱动以及工具之后需要修复一个小问题 12345Wel, FWIW, I changed the following two settings in &#x2F;etc&#x2F;default&#x2F;bluetooth :HID2HCI_E">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/16/rlGehD.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/16/rlGn9e.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/16/rlGu1H.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/16/rlGKcd.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/16/rlGMjA.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/16/rlGlnI.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/16/rlG1Bt.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/16/rlG3HP.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/16/rlGGAf.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/16/rlGJN8.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/16/rlGY4S.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/16/rlGN9g.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/16/rlGacj.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/16/rlGdjs.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/16/rlG0un.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/16/rlGBBq.png">
<meta property="article:published_time" content="2020-12-16T06:19:04.000Z">
<meta property="article:modified_time" content="2022-03-22T08:10:06.490Z">
<meta property="article:author" content="5k1l">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s3.ax1x.com/2020/12/16/rlGehD.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon.ico" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
          
        
    
    <!-- title -->
    <title>cve-2020-0022</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/lib/meslo-LG/styles.css">

    
<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">

    
<link rel="stylesheet" href="/css/style.css">

    <!-- rss -->
    
    
    <!-- jquery -->
    
<script src="/lib/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.2.0"></head>

<body>
    <div class="banner">
<!-- <div id="blogtitel" class="blogtitel">Hexo</div> -->
<!-- <ul id="wrapper" class="wrapper">
  <div class="sun">
    <div class="star"></div>
  </div>
  <div class="mercury">
    <div class="planet">
      <div class="shadow"></div>
    </div>
  </div>
  <div class="venus">
    <div class="planet">
      <div class="shadow"></div>
    </div>
  </div>
  <div class="earth">
    <div class="planet"><div class="shadow"></div></div>
  </div>
  <div class="mars">
    <div class="planet"><div class="shadow"></div></div>
  </div>
  <div class="jupiter">
    <div class="planet"><div class="shadow"></div></div>
  </div>
</ul> -->
</div>

    <div class="background">
      
        <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="/2020/01/12/CISCN2018%E7%88%B1%E5%8A%A0%E5%AF%86%E8%BF%87%E5%8F%8D%E8%B0%83%E8%AF%95%E7%9A%84%E5%B0%9D%E8%AF%95/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2020/12/16/cve-2020-0022/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2020/12/16/cve-2020-0022/&text=cve-2020-0022"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2020/12/16/cve-2020-0022/&title=cve-2020-0022"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2020/12/16/cve-2020-0022/&is_video=false&description=cve-2020-0022"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=cve-2020-0022&body=Check out this article: http://example.com/2020/12/16/cve-2020-0022/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2020/12/16/cve-2020-0022/&title=cve-2020-0022"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2020/12/16/cve-2020-0022/&title=cve-2020-0022"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2020/12/16/cve-2020-0022/&title=cve-2020-0022"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2020/12/16/cve-2020-0022/&title=cve-2020-0022"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2020/12/16/cve-2020-0022/&name=cve-2020-0022&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CVE-2020-0022-%E5%A4%8D%E7%8E%B0"><span class="toc-number">1.</span> <span class="toc-text">CVE-2020-0022 复现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87"><span class="toc-number">1.1.</span> <span class="toc-text">准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E7%9B%B8%E5%85%B3"><span class="toc-number">1.1.1.</span> <span class="toc-text">调试相关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%8F%E8%AE%AE%E7%9B%B8%E5%85%B3"><span class="toc-number">1.1.2.</span> <span class="toc-text">协议相关</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-number">1.2.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#exploit"><span class="toc-number">1.3.</span> <span class="toc-text">exploit</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#memcpy-bug"><span class="toc-number">1.3.1.</span> <span class="toc-text">memcpy bug</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#leak"><span class="toc-number">1.3.2.</span> <span class="toc-text">leak</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#leak-code-address-and-heap-address"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">leak code address and heap address</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#code-address"><span class="toc-number">1.3.2.1.1.</span> <span class="toc-text">code address</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#heap-address"><span class="toc-number">1.3.2.1.2.</span> <span class="toc-text">heap address</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pc-control"><span class="toc-number">1.3.3.</span> <span class="toc-text">pc control</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">1.4.</span> <span class="toc-text">参考文章</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

      
      <div class="content index width mx-auto px2 my4">
          
          <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        cve-2020-0022
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Hexo</span>
      </span>
      
    <div class="postdate">
        <time datetime="2020-12-16T06:19:04.000Z" itemprop="datePublished">2020-12-16</time>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="CVE-2020-0022-复现"><a href="#CVE-2020-0022-复现" class="headerlink" title="CVE-2020-0022 复现"></a>CVE-2020-0022 复现</h1><p>还差最后的rop部分</p>
<p>本文所用到的文件放在<a target="_blank" rel="noopener" href="https://github.com/5k1l/cve-2020-0022">github</a></p>
<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><h3 id="调试相关"><a href="#调试相关" class="headerlink" title="调试相关"></a>调试相关</h3><p>测试用的电脑系统是Ubuntu18.04 蓝牙设备 intel 8265</p>
<p>安装完必要的驱动以及工具之后需要<a target="_blank" rel="noopener" href="https://bbs.archlinux.org/viewtopic.php?id=222895">修复一个小问题</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Wel, FWIW, I changed the following two settings in /etc/default/bluetooth :</span><br><span class="line">HID2HCI_ENABLED=1</span><br><span class="line">HID2HCI_UNDO=1</span><br><span class="line">This got the Logitech MX Master to work.</span><br><span class="line">I did experience some flakiness in bluetooth connection after this; and am yet to debug that (do give it a shot &amp; let me know how things work out)</span><br></pre></td></tr></table></figure>

<p>在调试的时候如果出现一些奇奇怪怪的问题（大多数是因为还没有彻底断开连接？），可以尝试下重新开关下蓝牙开关</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo hciconfig hci0 down</span><br><span class="line">sudo hciconfig hci0 up</span><br></pre></td></tr></table></figure>

<p>测试手机是红米note5 </p>
<p>MIUI10 9.9.3 开发版本</p>
<p>android9 补丁版本 2019-09-05</p>
<p>因为miui上边有两个蓝牙相关的程序，所以我们需要确定在miui上边到底是哪个程序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">whyred:&#x2F; # ps -A |grep blue</span><br><span class="line">bluetooth    21568  1200 3952744  68580 SyS_epoll_wait 794bd1ac48 S com.xiaomi.bluetooth</span><br><span class="line">bluetooth    30419  1200 4007944  78640 SyS_epoll_wait 794bd1ac48 S com.android.bluetooth</span><br></pre></td></tr></table></figure>

<p>我用了一个比较暴力的方法去找的所在程序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">whyred:&#x2F;system # find . -type f |xargs strings -f |grep reassemble_and_dispatch</span><br><span class="line">.&#x2F;lib64&#x2F;libbluetooth.so: reassemble_and_dispatch</span><br><span class="line">.&#x2F;lib64&#x2F;libbluetooth_qti.so: reassemble_and_dispatch</span><br><span class="line">.&#x2F;lib&#x2F;libbluetooth.so: reassemble_and_dispatch</span><br><span class="line">.&#x2F;lib&#x2F;libbluetooth_qti.so: reassemble_and_dispatch</span><br><span class="line"></span><br><span class="line">whyred:&#x2F;proc # strings -f *&#x2F;maps|grep bluetooth</span><br><span class="line">········           </span><br><span class="line">30419&#x2F;maps: 78b0283000-78b02aa000 r-xp 00000000 103:1d 4172                          &#x2F;system&#x2F;lib64&#x2F;com.qualcomm.qti.bluetooth_audio@1.0.so</span><br><span class="line">30419&#x2F;maps: 78b02bb000-78b02bf000 r--p 0002c000 103:1d 4172                          &#x2F;system&#x2F;lib64&#x2F;com.qualcomm.qti.bluetooth_audio@1.0.so</span><br><span class="line">30419&#x2F;maps: 78b02bf000-78b02c0000 rw-p 00030000 103:1d 4172                          &#x2F;system&#x2F;lib64&#x2F;com.qualcomm.qti.bluetooth_audio@1.0.so</span><br><span class="line">30419&#x2F;maps: 78b02c4000-78b0638000 r-xp 00000000 103:1d 4260                          &#x2F;system&#x2F;lib64&#x2F;libbluetooth_qti.so</span><br><span class="line">30419&#x2F;maps: 78b0657000-78b0661000 r--p 00376000 103:1d 4260                          </span><br><span class="line">·····</span><br></pre></td></tr></table></figure>

<p>经过确定之后发现实际用到的是libbluetooth_qti,程序是com.android.bluetooth。后来调试的时候发现附加上应用之后，暂停应用时间过长的话，com.android.bluetooth 会超时，然后被杀掉。再看文章，发现作者使用了gdb脚本来进行调试（分析），于是我抄了一份脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">adb forward tcp:1234 tcp:1234</span><br><span class="line">adb push ./attach.sh /sdcard/  </span><br><span class="line">adb shell <span class="string">&quot;su -c cp /sdcard/attach.sh /data/local/&quot;</span></span><br><span class="line">adb shell <span class="string">&quot;su -c chmod +x /data/local/attach.sh&quot;</span></span><br><span class="line">adb shell <span class="string">&quot;su -c sh  /data/local/attach.sh&quot;</span> &amp;</span><br><span class="line">sleep 1s</span><br><span class="line">gdb --ex <span class="string">&quot;source ./gdbinit&quot;</span> ./libbluetooth_qti.so </span><br></pre></td></tr></table></figure>

<p>start.sh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">killpid=$(ps -A|grep gdb|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> [  <span class="variable">$killpid</span> ];</span><br><span class="line"><span class="keyword">then</span> </span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;killpid&#125;</span></span><br><span class="line"><span class="built_in">kill</span> -9 <span class="variable">$&#123;killpid&#125;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">cd</span> /data/<span class="built_in">local</span>/</span><br><span class="line">pid=$(ps -A|grep android.blue|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">./gdb :1234 --attach <span class="variable">$&#123;pid&#125;</span></span><br></pre></td></tr></table></figure>

<p>attach.sh</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">set sysroot .</span><br><span class="line">set architecture aarch64</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">set</span> auto-solib-add off</span></span><br><span class="line">set follow-fork-mode child </span><br><span class="line">set pagination off</span><br><span class="line"></span><br><span class="line">target remote :1234</span><br><span class="line">b *reassemble_and_dispatch</span><br><span class="line">	commands 1</span><br><span class="line">	x/10gx $x0-0x40</span><br><span class="line">	print &quot;reassemble_and_dispatch param&quot;</span><br><span class="line">	x/10gx $x0</span><br><span class="line">	c</span><br><span class="line">end</span><br><span class="line">set $bbl = 3</span><br><span class="line">b *(reassemble_and_dispatch+1176)</span><br><span class="line">	commands 2</span><br><span class="line">	set $dst  = $x0</span><br><span class="line">	set $src =  $x1</span><br><span class="line">	set $length = $x2</span><br><span class="line">	p/x $dst</span><br><span class="line">	p/x $src</span><br><span class="line">	p/x $length</span><br><span class="line">	x/30gx ($dst&amp;(~0xf))-0x50</span><br><span class="line">	tb *dispatch_reassembled</span><br><span class="line">		commands $bbl</span><br><span class="line">		x/10gx $x0-0x40</span><br><span class="line">		print &quot;dispatch_reassembled param&quot;</span><br><span class="line">		x/30gx $x0</span><br><span class="line">		set $bbl=$bbl+1</span><br><span class="line">		c</span><br><span class="line">	end</span><br><span class="line">	c</span><br><span class="line">end</span><br><span class="line">c</span><br></pre></td></tr></table></figure>

<p>gdbinit 文件</p>
<p>这里还有一个问题，可能是我的机器性能太差，pwndbg之类的插件并不能正常使用，如果加载了这些插件程序在调试时就会被超时kill</p>
<h3 id="协议相关"><a href="#协议相关" class="headerlink" title="协议相关"></a>协议相关</h3><p>HCI(Host Controller Interface) 实现了对控制器的统一接口，使得Host(可以简单的理解成主机上的软件)和Controller（硬件控制器）之间的通讯简单了起来，他们之间的通讯是通过HCI Packet进行的。包括 </p>
<ol>
<li>HCI Command host-&gt;controller </li>
<li>HCI Event  controller-&gt;host </li>
<li>HCI Data host&lt;-&gt;controller 这个包又分为 ACL(异步传输，不可靠) SCO （同步传输，可靠）</li>
</ol>
<p>通讯抓包如下</p>
<p><img src="https://s3.ax1x.com/2020/12/16/rlGehD.png" alt="image-20201216111257419"></p>
<p>我们用到的结构体如下</p>
<p><img src="https://s3.ax1x.com/2020/12/16/rlGn9e.png" alt="image-20201216114323483"></p>
<p>其中handle中包含handle ， PB ，BC 三个字端</p>
<p>PB字段</p>
<ol>
<li>00  host-&gt;controller 10 controller-&gt;host 首包 经过测试发现10 00在ubuntu上 效果是一样的：）</li>
<li>01 controller&lt;-&gt;host 续包</li>
</ol>
<p>包中各个关系如下</p>
<p><img src="https://s3.ax1x.com/2020/12/16/rlGu1H.png" alt="image-20201216134029824"></p>
<h2 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h2><p>相关文章分析的也都挺详细了,</p>
<p><img src="https://s3.ax1x.com/2020/12/16/rlGKcd.png" alt="image-20201130221738348"></p>
<p>主要问题是这里packet-&gt;len已经被修正了为真正需要拷贝的长度了，但是下边又减去了hci_hdr的长度</p>
<p>如果这时候<code>真正需要拷贝的长度&lt;4</code>,就会发生整数溢出，导致传入memcpy的size是个负数，如果大于4，那么就会得到4字节未初始化的内存</p>
<h2 id="exploit"><a href="#exploit" class="headerlink" title="exploit"></a>exploit</h2><h3 id="memcpy-bug"><a href="#memcpy-bug" class="headerlink" title="memcpy bug"></a>memcpy bug</h3><p>这个漏洞可以实现RCE，是用到了memcpy的一个bug</p>
<p>具体的分析在参考文章中也有，我这里再啰嗦一遍</p>
<p><a target="_blank" rel="noopener" href="https://android.googlesource.com/platform/bionic/+/refs/tags/android-9.0.0_r49/libc/arch-arm64/generic/bionic/memcpy_base.S">安卓memcpy底层实现</a></p>
<p>考虑这么一种情况</p>
<p>(count+(dst&amp;0xf))&gt;MAXINT64 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">	prfm    PLDL1KEEP, [src]</span><br><span class="line">	add	srcend, src, count</span><br><span class="line">	add	dstend, dstin, count</span><br><span class="line">  cmp     count, 16</span><br><span class="line">  b.ls    L(copy16);小于0x10跳转</span><br><span class="line">	cmp	count, 96</span><br><span class="line">	b.hi	L(copy_long);大于0x60</span><br><span class="line">········</span><br><span class="line">L(copy_long):</span><br><span class="line">	and	tmp1, dstin, 15;tmpl &#x3D; dstin&amp;0xf</span><br><span class="line">	bic	dst, dstin, 15 ;dst &#x3D; dstin&amp;(~0xf)</span><br><span class="line">	ldp	D_l, D_h, [src];load [src] to d_l d_h</span><br><span class="line">	sub	src, src, tmp1;src &#x3D; src-tmpl dst 可以对齐 src不对齐</span><br><span class="line">	add	count, count, tmp1;count &#x3D; count+tmpl overflow 	&#x2F;* Count is now 16 too large.  *&#x2F;</span><br><span class="line">	ldp	A_l, A_h, [src, 16];same </span><br><span class="line">	stp	D_l, D_h, [dstin];write to dstin</span><br><span class="line">	ldp	B_l, B_h, [src, 32];</span><br><span class="line">	ldp	C_l, C_h, [src, 48]</span><br><span class="line">	ldp	D_l, D_h, [src, 64]</span><br><span class="line">	subs	count, count, 128 + 16;0x10+0x80	&#x2F;* Test and readjust count.  *&#x2F;</span><br><span class="line">	b.ls	2f ;less than jump to ret</span><br><span class="line">1:</span><br><span class="line">·········</span><br><span class="line">	&#x2F;* Write the last full set of 64 bytes.	 The remainder is at most 64</span><br><span class="line">	   bytes, so it is safe to always copy 64 bytes from the end even if</span><br><span class="line">	   there is just 1 byte left.  *&#x2F;</span><br><span class="line">2:</span><br><span class="line">	ldp	E_l, E_h, [srcend, -64];正常流程到这的话，因为size大 所以反向复制不会出问题的</span><br><span class="line">	stp	A_l, A_h, [dst, 16]</span><br><span class="line">	ldp	A_l, A_h, [srcend, -48]</span><br><span class="line">	stp	B_l, B_h, [dst, 32]</span><br><span class="line">	ldp	B_l, B_h, [srcend, -32]</span><br><span class="line">	stp	C_l, C_h, [dst, 48]</span><br><span class="line">	ldp	C_l, C_h, [srcend, -16]</span><br><span class="line">	stp	D_l, D_h, [dst, 64]</span><br><span class="line">	stp	E_l, E_h, [dstend, -64]</span><br><span class="line">	stp	A_l, A_h, [dstend, -48]</span><br><span class="line">	stp	B_l, B_h, [dstend, -32]</span><br><span class="line">	stp	C_l, C_h, [dstend, -16]</span><br><span class="line">	ret</span><br></pre></td></tr></table></figure>

<p>走一遍流程可以看到，这种特殊情况下memcpy是不会陷入拷贝死循环的</p>
<p>同时dst我们都能够控制&amp;0xf的部分 </p>
<p>在上述情况，memcpy会先拷贝[src,src+0x40)到[dst,dst+0x40) 之后 会拷贝 [srcend-0x40,srcend)到[dstend-0x40,dstend)</p>
<p>dstend = dst+count &lt; dst(count 溢出成负数了),这样相当于我们能够溢出两部分，一部分是向后溢出，另外一部分是向前修改</p>
<h3 id="leak"><a href="#leak" class="headerlink" title="leak"></a>leak</h3><p>在memcpy bug中我们发现能够前向溢出0x40 后向溢出0x40 </p>
<p>看源码可以发现，当有续包的时候，原来的数据会被free掉，如果没有则会进入<code>reassembled</code></p>
<p><img src="https://s3.ax1x.com/2020/12/16/rlGMjA.png" alt="image-20201130222723172"></p>
<p>经过调试我们可以发现，直接进入<code>reassembled</code>的包暂时不会被free，并且同样大小的包是在一块的（可以看参考文章<code>基于jemalloc的Android漏洞利用技巧</code>）</p>
<p><img src="https://s3.ax1x.com/2020/12/16/rlGlnI.png" alt="image-20201130222920841"></p>
<p>我们可以提前布置好数据，使用mempcy前向覆盖掉头部的一些长度控制信息，来实现leak内存数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">第一个包</span><br><span class="line">Thread 33 &quot;HwBinder:14052_&quot; hit Breakpoint 1, 0x0000007bbb369610 in reassemble_and_dispatch(BT_HDR*) () from .&#x2F;system&#x2F;lib64&#x2F;libbluetooth_qti.so</span><br><span class="line">0x7c5ac3aa90:	0x6161616100366e08	0x027c028000026161</span><br><span class="line">0x7c5ac3aaa0:	0xffff027866080001	0xffffffffffffffff</span><br><span class="line">0x7c5ac3aab0:	0xffffffffffffffff	0xffffffffffffffff</span><br><span class="line">0x7c5ac3aac0:	0xffffffffffffffff	0x78080001003affff</span><br><span class="line">0x7c5ac3aad0:	0x0000000000421100	0x0001003c003e2002</span><br><span class="line">$65 &#x3D; &quot;reassemble_and_dispatch param&quot;</span><br><span class="line">0x7c5ac3aad0:	0x0000000000421100	0x0001003c003e2002</span><br><span class="line">0x7c5ac3aae0:	0x0101010100386f08	0x0101010101010101</span><br><span class="line">0x7c5ac3aaf0:	0x0101010101010101	0x0101010101010101</span><br><span class="line">0x7c5ac3ab00:	0x0101010101010101	0x0101010101010101</span><br><span class="line">0x7c5ac3ab10:	0x0101010101010101	0x0000000000000101</span><br><span class="line">第二个包</span><br><span class="line">Thread 33 &quot;HwBinder:14052_&quot; hit Breakpoint 1, 0x0000007bbb369610 in reassemble_and_dispatch(BT_HDR*) () from .&#x2F;system&#x2F;lib64&#x2F;libbluetooth_qti.so</span><br><span class="line">0x7c5ac3aa90:	0x6161616100366e08	0x027c028000026161</span><br><span class="line">0x7c5ac3aaa0:	0xffff027866080001	0xffffffffffffffff</span><br><span class="line">0x7c5ac3aab0:	0xffffffffffffffff	0xffffffffffffffff</span><br><span class="line">0x7c5ac3aac0:	0xffffffffffffffff	0x78080001003affff</span><br><span class="line">0x7c5ac3aad0:	0x0000000000421100	0x0001003a003e1002</span><br><span class="line">$66 &#x3D; &quot;reassemble_and_dispatch param&quot;</span><br><span class="line">0x7c5ac3aad0:	0x0000000000421100	0x0001003a003e1002</span><br><span class="line">0x7c5ac3aae0:	0x0202020200367008	0x0202020202020202</span><br><span class="line">0x7c5ac3aaf0:	0x0202020202020202	0x0202020202020202</span><br><span class="line">0x7c5ac3ab00:	0x0202020202020202	0x0202020202020202</span><br><span class="line">0x7c5ac3ab10:	0x0202020202020202	0x0000000000000202</span><br><span class="line">memcpy</span><br><span class="line">Thread 33 &quot;HwBinder:14052_&quot; hit Breakpoint 2, 0x0000007bbb369aa8 in reassemble_and_dispatch(BT_HDR*) () from .&#x2F;system&#x2F;lib64&#x2F;libbluetooth_qti.so</span><br><span class="line">$67 &#x3D; 0x7c5ac3b6aa</span><br><span class="line">$68 &#x3D; 0x7c5ac3aadc</span><br><span class="line">$69 &#x3D; 0xfffffffffffffffe</span><br><span class="line">0x7c5ac3b650:	0xffffffffffffffff	0x006b6162006cffff</span><br><span class="line">0x7c5ac3b660:	0x0000004200441100	0x0001003c00402002</span><br><span class="line">0x7c5ac3b670:	0x0101010100386f08	0x0101010101010101</span><br><span class="line">0x7c5ac3b680:	0x0101010101010101	0x0101010101010101</span><br><span class="line">0x7c5ac3b690:	0x0101010101010101	0x0101010101010101</span><br><span class="line">0x7c5ac3b6a0:	0x0101010101010101	0x0000000000000101</span><br><span class="line">0x7c5ac3b6b0:	0x0000007c5acf6df0	0xb61c5e94f8342798</span><br><span class="line">0x7c5ac3b6c0:	0x0000000000000000	0x0000007c5b007165</span><br><span class="line">0x7c5ac3b6d0:	0x000000000000000e	0x0000000000000000</span><br><span class="line">0x7c5ac3b6e0:	0x0000007c5b007174	0x0000000000000009</span><br><span class="line">0x7c5ac3b6f0:	0x0000000000000b56	0x0000000000000000</span><br><span class="line">0x7c5ac3b700:	0x63657269646e6924	0x6174206665722074</span><br><span class="line">0x7c5ac3b710:	0x0000000000656c62	0x0000007bcf5ac000</span><br><span class="line">0x7c5ac3b720:	0x0000000000002000	0x0000007bcf5ac000</span><br><span class="line">0x7c5ac3b730:	0x0000000000002000	0x0061000000000003</span><br><span class="line">Temporary breakpoint 9 at 0x7bbb364a68</span><br><span class="line">最后返回的包</span><br><span class="line">Thread 33 &quot;HwBinder:14052_&quot; hit Temporary breakpoint 9, 0x0000007bbb364a68 in dispatch_reassembled(BT_HDR*) () from .&#x2F;system&#x2F;lib64&#x2F;libbluetooth_qti.so</span><br><span class="line">0x7c5ac3b620:	0x6161616100367508	0x027c028000016161</span><br><span class="line">0x7c5ac3b630:	0xffff027866080001	0xffffffffffffffff</span><br><span class="line">0x7c5ac3b640:	0xffffffffffffffff	0xffffffffffffffff</span><br><span class="line">0x7c5ac3b650:	0xffffffffffffffff	0x006b6162006cffff</span><br><span class="line">0x7c5ac3b660:	0x0000000000441100	0x0001027c02800002</span><br><span class="line">$70 &#x3D; &quot;dispatch_reassembled param&quot;</span><br><span class="line">0x7c5ac3b660:	0x0000000000441100	0x0001027c02800002</span><br><span class="line">0x7c5ac3b670:	0xffffffff02786608	0xffffffffffffffff</span><br><span class="line">0x7c5ac3b680:	0xffffffffffffffff	0xffffffffffffffff</span><br><span class="line">0x7c5ac3b690:	0xffffffffffffffff	0x110078080001003a</span><br><span class="line">0x7c5ac3b6a0:	0x1002000000040002	0x70080001003a0101</span><br><span class="line">0x7c5ac3b6b0:	0x0202020202020036	0x0202020202020202</span><br><span class="line">0x7c5ac3b6c0:	0x0202020202020202	0x0202020202020202</span><br><span class="line">0x7c5ac3b6d0:	0x0202020202020202	0x0202020202020202</span><br><span class="line">0x7c5ac3b6e0:	0x0202020202020202	0x66d8000000000000</span><br><span class="line">0x7c5ac3b6f0:	0x0000000000000b56	0x0000000000000000</span><br><span class="line">0x7c5ac3b700:	0x63657269646e6924	0x6174206665722074</span><br><span class="line">0x7c5ac3b710:	0x0000000000656c62	0x0000007bcf5ac000</span><br><span class="line">0x7c5ac3b720:	0x0000000000002000	0x0000007bcf5ac000</span><br><span class="line">0x7c5ac3b730:	0x0000000000002000	0x0061000000000003</span><br><span class="line">0x7c5ac3b740:	0x0000000000000000	0x0000000000720065</span><br></pre></td></tr></table></figure>



<h4 id="leak-code-address-and-heap-address"><a href="#leak-code-address-and-heap-address" class="headerlink" title="leak code address and heap address"></a>leak code address and heap address</h4><h5 id="code-address"><a href="#code-address" class="headerlink" title="code address"></a>code address</h5><p>这里使用了0x38 + 2 + 13 大小的堆块进行泄漏</p>
<p>从leak中发现了如下几个地方比较常见</p>
<p> 0x74b3d2a898(几率较大)</p>
<p><img src="https://s3.ax1x.com/2020/12/16/rlG1Bt.png" alt="image-20201130201835500"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  myexploit .&#x2F;maps_find.py .&#x2F;maps 0x74b3d2a898</span><br><span class="line">finding 0x74b3d2a898 in .&#x2F;maps</span><br><span class="line">find</span><br><span class="line">74b3d1c000-74b3d3b000 r--p 00211000 103:1d 4399                          &#x2F;system&#x2F;lib64&#x2F;libandroid_runtime.so</span><br></pre></td></tr></table></figure>

<p>另外一次leak</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  myexploit .&#x2F;maps_find.py .&#x2F;maps1 0x7c565aa898</span><br><span class="line">finding 0x7c565aa898 in .&#x2F;maps1</span><br><span class="line">find</span><br><span class="line">7c5659c000-7c565bb000 r--p 00211000 103:1d 4399                          &#x2F;system&#x2F;lib64&#x2F;libandroid_runtime.so</span><br></pre></td></tr></table></figure>

<p><img src="https://s3.ax1x.com/2020/12/16/rlG3HP.png" alt="image-20201130203427606"></p>
<p>0x7415a25bf0</p>
<p><img src="https://s3.ax1x.com/2020/12/16/rlGGAf.png" alt="image-20201130202014131"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  myexploit .&#x2F;maps_find.py .&#x2F;maps 0x7415a25bf0</span><br><span class="line">finding 0x7415a25bf0 in .&#x2F;maps</span><br><span class="line">find</span><br><span class="line">7415a21000-7415a2b000 r--p 00376000 103:1d 4260                          &#x2F;system&#x2F;lib64&#x2F;libbluetooth_qti.so</span><br></pre></td></tr></table></figure>

<h5 id="heap-address"><a href="#heap-address" class="headerlink" title="heap address"></a>heap address</h5><p>来看这一句</p>
<p><img src="https://s3.ax1x.com/2020/12/16/rlGJN8.png" alt="image-20201216132644083"></p>
<p>我们自己写一个来试试</p>
<p><img src="https://s3.ax1x.com/2020/12/16/rlGY4S.png" alt="image-20201216134856225"></p>
<p><img src="https://s3.ax1x.com/2020/12/16/rlGN9g.png" alt="image-20201216134838919"></p>
<p>可以看到一项是一个堆块</p>
<p>返回来看bluetooth_qti.so</p>
<p><img src="https://s3.ax1x.com/2020/12/16/rlGacj.png" alt="image-20201216135218119"></p>
<p><img src="https://s3.ax1x.com/2020/12/16/rlGdjs.png" alt="image-20201216135235418"></p>
<p><img src="https://s3.ax1x.com/2020/12/16/rlG0un.png" alt="image-20201216135246530"></p>
<p>那么，我们利用上述手法即可泄漏出真实堆地址（只是不稳定</p>
<p><img src="https://s3.ax1x.com/2020/12/16/rlGBBq.png" alt="image-20201216135654310"></p>
<h3 id="pc-control"><a href="#pc-control" class="headerlink" title="pc control"></a>pc control</h3><p>调试中发现，发送0x38畸形数据会有很大的几率触发以下代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.text:000000000013B9EC                 LDR             X8, [X8,#8]</span><br><span class="line">.text:000000000013B9F0                 MOV             X0, X19</span><br><span class="line">.text:000000000013B9F4</span><br><span class="line">.text:000000000013B9F4 loc_13B9F4                              ; CODE XREF: sub_13B610+4E8↓j</span><br><span class="line">.text:000000000013B9F4                 BLR             X8</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000000E93C4                 LDR             X8, [X19]</span><br><span class="line">.text:00000000000E93C8                 MOV             X1, X2</span><br><span class="line">.text:00000000000E93CC                 LDR             X22, [X8]</span><br><span class="line">.text:00000000000E93D0                 BL              ._ZN4base8internal13WeakReferenceC2EOS1__1 ; base::internal::WeakReference::WeakReference(base::internal::WeakReference&amp;&amp;)</span><br><span class="line">.text:00000000000E93D4                 MOV             X2, SP</span><br><span class="line">.text:00000000000E93D8                 MOV             X0, X19</span><br><span class="line">.text:00000000000E93DC                 MOV             X1, X20</span><br><span class="line">.text:00000000000E93E0                 MOV             X3, XZR</span><br><span class="line">.text:00000000000E93E4                 BLR             X22</span><br></pre></td></tr></table></figure>

<p>此时 x8是x19指向的内容 x19指向当前包 只要我们能够准确知道上述两个地址，那么就能够控制pc了，之后就可以用rop来操作了</p>
<p>以及crash2.c中的方式会触发一个类似的代码   </p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p><a target="_blank" rel="noopener" href="https://insinuator.net/2020/04/cve-2020-0022-an-android-8-0-9-0-bluetooth-zero-click-rce-bluefrag/">CVE-2020-0022 an Android 8.0-9.0 Bluetooth Zero-Click RCE – BlueFrag</a></p>
<p><a target="_blank" rel="noopener" href="https://bestwing.me/Android-8.1-memcpy-func.html">Android 8.1 上 memcpy 一点有趣的东西</a></p>
<p><a target="_blank" rel="noopener" href="https://bestwing.me/CVE-2020-0022-analysis.html">CVE-2020-0022 “BlueFrag”漏洞分析</a></p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/207974">CVE-2020-0022 蓝牙漏洞初探（上）一个bug引发的血案</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/cpongo1/article/details/102472653">蓝牙核心技术概述（四）：蓝牙协议规范（HCI、L2CAP、SDP、RFOCMM）</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u012800825/article/details/88858313">Bluetooth技术学习笔记 ——L2CAP之信令包格式</a></p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/85982">基于jemalloc的Android漏洞利用技巧</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/hzl6255/article/details/33801373">Bluetooth HCI介绍</a></p>

  </div>
</article>



      </div>
      
       <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CVE-2020-0022-%E5%A4%8D%E7%8E%B0"><span class="toc-number">1.</span> <span class="toc-text">CVE-2020-0022 复现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87"><span class="toc-number">1.1.</span> <span class="toc-text">准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E7%9B%B8%E5%85%B3"><span class="toc-number">1.1.1.</span> <span class="toc-text">调试相关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%8F%E8%AE%AE%E7%9B%B8%E5%85%B3"><span class="toc-number">1.1.2.</span> <span class="toc-text">协议相关</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-number">1.2.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#exploit"><span class="toc-number">1.3.</span> <span class="toc-text">exploit</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#memcpy-bug"><span class="toc-number">1.3.1.</span> <span class="toc-text">memcpy bug</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#leak"><span class="toc-number">1.3.2.</span> <span class="toc-text">leak</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#leak-code-address-and-heap-address"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">leak code address and heap address</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#code-address"><span class="toc-number">1.3.2.1.1.</span> <span class="toc-text">code address</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#heap-address"><span class="toc-number">1.3.2.1.2.</span> <span class="toc-text">heap address</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pc-control"><span class="toc-number">1.3.3.</span> <span class="toc-text">pc control</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">1.4.</span> <span class="toc-text">参考文章</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2020/12/16/cve-2020-0022/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2020/12/16/cve-2020-0022/&text=cve-2020-0022"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2020/12/16/cve-2020-0022/&title=cve-2020-0022"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2020/12/16/cve-2020-0022/&is_video=false&description=cve-2020-0022"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=cve-2020-0022&body=Check out this article: http://example.com/2020/12/16/cve-2020-0022/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2020/12/16/cve-2020-0022/&title=cve-2020-0022"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2020/12/16/cve-2020-0022/&title=cve-2020-0022"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2020/12/16/cve-2020-0022/&title=cve-2020-0022"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2020/12/16/cve-2020-0022/&title=cve-2020-0022"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2020/12/16/cve-2020-0022/&name=cve-2020-0022&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick='$("#toc-footer").toggle();return false;'><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick='$("#share-footer").toggle();return false;'><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick='$("#nav-footer").toggle();return false;'><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

      
      <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2022 5k1l
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

      
<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>


<script src="/js/main.js"></script>

<!-- Google Analytics -->

<!-- Disqus Comments -->


    </div>
</body>
</html>
